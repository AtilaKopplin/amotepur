# Estimação de proporções

## Parâmetros populacionais

Um caso especial de parâmetro de interesse para muitos estudos ou pesquisas ocorre quando a variável $y$ indica se uma determinada unidade populacional tem ou não uma determinada característica ou atributo, ou pertence a um determinado grupo especificado de unidades da população. São exemplos desse tipo as investigações sobre:

* migrantes entre os habitantes de determinada região;
* estabelecimentos agropecuários que se dedicam exclusivamente à produção leiteira numa determinada localidade;
* estudantes do sexo feminino em escolas;
* sondagens eleitorais, onde se deseja conhecer qual parcela dos eleitores pretende votar em determinado candidato.

Sendo uma variável indicadora, a variável $y$ irá assumir para cada unidade da população um de dois valores possíveis: o valor 1, se a unidade possui o atributo de interesse, ou o valor 0, caso a unidade não possua o atributo. Para fins de apresentação, seja $A \subset U$ o subconjunto das unidades da população $U$ que possuem o atributo de interesse. Então, para cada unidade $i$ da população, a variável $y$ será definida como:

$$
y_i = I(i \in A) = \displaystyle \begin{cases} 1, \text {se a unidade i possui o atributo de interesse} \\\\ 0, \text {se a unidade i não possui o atributo de interesse} \end{cases} (\#eq:eqpro1)
$$

O total populacional da variável $y$ coincide com a contagem do número de unidades populacionais que possuem o atributo de interesse, ou que pertencem ao subconjunto $A$, e pode ser representado como:

$$
Y = \displaystyle \sum_{i \in U} y_i = N_A  (\#eq:eqpro2)
$$
onde $N_A$ representa o número de unidades populacionais que possuem o atributo de interesse.

Um exemplo clássico do uso de variáveis indicadoras ocorre quando se quer tabular frequências de respostas a uma pergunta categórica numa pesquisa ou censo. Considere uma pergunta cujas respostas podem ser um dos valores inteiros de $1$ a $C$, onde $C$ representa o número de categorias de resposta da pergunta. Por exemplo, para a pergunta 'Qual é o sexo do morador', há duas categorias de resposta ($C=2$): 1 (=Feminino) e 2 (=Masculino). Logo, para contar o número de pessoas por sexo na população, seria necessário criar duas variáveis indicadoras: $y_{1i} = I[Sexo(i) = 1]$ e $y_{2i} = I[Sexo(i) = 2]$. Estas contagens poderiam ser representadas por $N_1$ para as pessoas do sexo Feminino, e $N_2$ para as pessoas do sexo Masculino, que seriam obtidos como dois totais populacionais:

$$
\begin {eqnarray}
Y_1 = \displaystyle \sum_{i \in U} y_{1i} = N_1
\\
Y_2 = \displaystyle \sum_{i \in U} y_{2i} = N_2
\end {eqnarray}
$$

Como já adiantado no capítulo 3, quando a variável $y$ é do tipo indicadora, a *média populacional* dada por: 

$$
\overline {Y} = \displaystyle \frac{1}{N} \sum_{i \in U} y_i = \frac {Y}{N} = \frac {N_A} {N} = p \, \, (\#eq:eqpro3)
$$

corresponde à *proporção* $p$ de unidades da população que têm o atributo de interesse. O parâmetro populacional *proporção* é aqui representado pela letra $p$ minúscula, já que a letra $P$ maiúscula já foi usada para denotar *probabilidade*.

Uma *proporção* pode assumir valores variando entre $0$, quando nenhuma unidade da população tem o atributo investigado, até $1$, quando todas as unidades possuem esse atributo. Muitas vezes é interessante expressar a *proporção* sob forma de porcentagem podendo então variar de 0% até 100%.

Como $y$ só pode receber valores $1$ ou $0$, a expressão da sua *variância* populacional pode ser simplificada:

$$
S^2_y = \displaystyle \frac {1}{N-1} \left( \sum_{i \in U} y^2_i - N \overline{Y}^2 \right) = \frac{1}{N-1} \left(Np-Np^2 \right) = \frac{N}{N-1} p \left(1-p\right) . (\#eq:eqpro4)
$$ 

A *variância* populacional de $y$ pode também ser definida como $\sigma^2_y = p (1-p)$. Tanto $S^2_y$ como $\sigma^2_y$ representam a dispersão da distribuição dos valores de $y$ na população. Para populações com um grande número de unidades ($N \displaystyle \rightarrow \infty,$), é fácil verificar que as duas quantidades são praticamente iguais, pois pode-se considerar $S^2_y \displaystyle \approx p(1-p) = \sigma^2_y$.

Outra medida importante para avaliar a dispersão de uma variável é o seu *Coeficiente de Variação* ou *CV*, definido como a divisão do *Desvio Padrão* de $y$ por sua média:

$$
CV_y = \frac {\sqrt {\sigma^2_y}} {\overline Y} = \sqrt {{p(1-p) / p^2}} = \sqrt {(1-p)/p} (\#eq:eqpro5) 
$$

**Exemplo 5.1:** Seja uma escola de ensino fundamental onde se deseja estudar a composição dos estudantes por sexo. Vamos supor que a escola tenha um total de 1000 estudantes, dos quais 480 são do sexo feminino. Pode-se definir a variável $y$ de interesse como:
$$
y_i = \displaystyle \begin{cases} 1, \,\, \text {se o estudante for do sexo feminino} \\\\ 0, \,\, \text {em outro caso} \end{cases}
$$

O total de meninas da escola será o total da variável $y$, dado por: 
$$
 Y = N_A = \displaystyle \sum_{i \in U} y_i = 1+1+0+1+...+0+1+1 = 480 
$$
A *média* da variável $y$, que neste caso é também de *proporção* de meninas entre os estudantes da escola, é igual a:
$$
\overline Y = \frac Y N = \frac {N_A}{N} = p = \frac {480} {1000}=0,48 \text { ou }  48\text{%}
$$

A *variância* da variável $y$, medida por $S^2_y$ é igual a:
$$
S^2_y = \frac N {N-1}p(1-p) = \frac{1000}{999} \times 0,48 \times 0,52 \doteq 0,24985
$$

e quando medida por $\sigma^2_y$ fica igual a
$$
\sigma^2_y = p(1-p) = 0,48 \times 0,52 = 0,2496
$$

Finalmente, o *coeficiente de variação* de $y$ é igual a:
$$
CV_y = \sqrt {\frac {1-p}{p}} = \sqrt \frac{0,52}{0,48} \doteq 1,041
$$

Nas duas seções seguintes tratamos do problema da estimação desses parâmetros populacionais a partir dos dados de amostras aleatórias simples retiradas da população de interesse com e sem reposição, respectivamente.


## Estimação sob Amostragem Aleatória Simples com reposição - *AASC*

Seja $s$ uma *AASC* de tamanho $n$ selecionada de uma população composta de $N$ unidades, onde se observa uma variável indicadora $y$ como definida na seção anterior. Pode-se obter estimadores para os parâmetros populacionais de $y$ adaptando os estimadores gerais de total e média apresentados no capítulo anterior.

O total de unidades da amostra com o atributo de interesse $n_A$ será dado pela soma amostral:

$$
t_y = \displaystyle \sum_{i \in\ s} y_i = n_A \,\, (\#eq:eqpro6) 
$$
O total de unidades com o atributo de interesse, $N_A$, é estimado usando:

$$
\widehat Y_{AASC} = N \times t_y / n = N \times n_A / n = \widehat {N}_A (\#eq:eqpro7)
$$
Como indicado no capítulo anterior, este estimador é não viciado sob AASC para qualquer variável $y$, logo é ENV também quando $y$ é do tipo indicadora, como aqui definido.

A *proporção amostral* de unidades que possuem o atributo de interesse é dada pela *média amostral*:

$$
\displaystyle \overline y = \frac {1}{n} \sum_{i \in s} y_i = \frac {n_A}{n} =  \widehat p \,\, (\#eq:eqpro8) 
$$

Pode-se facilmente verificar que $\widehat p$ é um *estimador não viciado* para a *proporção* populacional $p$, pois:

$$
\displaystyle E_{AASC} (\widehat p) = E_{AASC} (\overline y) = \overline Y = p \,\, (\#eq:eqpro9) 
$$

A *variância da proporção amostral* sob AASC é dada por:

$$
\displaystyle V_{AASC} (\widehat p) = \frac {\sigma^2_y}{n} = \frac {p(1-p)}{n} \,\, (\#eq:eqpro10) 
$$

A *variância amostral* de $y$ é dada por:

$$
\displaystyle s^2_y = \frac {n}{n-1} \widehat p (1 - \widehat p) (\#eq:eqpro11) 
$$

Sob AASC, a *variância amostral*$s^2_y$ é um estimador não viciado para a *variância populacional* $\sigma^2_y$. Assim se obtem um estimador não viciado para a variância do estimador $\widehat p$ como:

$$
\displaystyle \widehat {V}_{AASC} (\widehat p) = \frac {\widehat p (1 - \widehat p)}{n-1} \,\, (\#eq:eqpro12) 
$$

O quadro 5.1 reúne os resultados principais da estimação de contagens e proporções sob *AASC*.

\begin{eqnarray} {|c|c|} \hline
\textrm{Parâmetro} & \textrm{Estimador ENV sob AASC} 
\\ \hline N_A = \displaystyle \sum_{i \in U} y_i & \widehat N_A = N \times n_A / n = N \times p
\\ \hline p = N_A / n & \widehat{p} = n_a / n 
\\ \hline \sigma^2_y = p (1-p) & s^2_y = \displaystyle \frac{n}{n-1} \widehat p (1 - \widehat p)  
\\ \hline V_{AASC}(\widehat N_A) = N^2 \frac {p(1-p)}{n} & \widehat V_{AASC} (\widehat N_A) = N^2 \widehat{p} (1 - \widehat{p}) / (n - 1)
\\ \hline V_{AASC} (\widehat p) = \frac {p(1-p)}{n} & \widehat V_{AASC}(\widehat{p}) = \widehat{p} (1 - \widehat{p}) / (n - 1)
\\ \hline
\end{eqnarray}


## Estimação sob Amostragem Aleatória Simples sem reposição - *AAS*

No caso de uma amostra $s$ obtida por seleção do tipo *AAS*, as expressões da soma amostral $t_y$, da proporção amostral $\widehat p$ e da variância amostral $s^2_y$ têm a mesma forma já apresentada acima para amostras obtidas por *AASC*. Em consequência, também são idênticos os estimadores para o total populacional $N_A$ e a proporção populacional $p$. Entretanto, uma diferença é que no caso da *AAS* a variância amostral $s^2_y$ é um estimador não viciado para $S^2y$ e não para $\sigma^2_y$. Também são diferentes as expressões para as variâncias dos estimadores amostrais e seus correspondentes estimadores não viciados.

Foi visto no capítulo \@ref(aas) que as variâncias dos estimadores do total e da média são dadas pelas expressões:

$$
V_{AAS} (\widehat Y) = N^2 \left( \frac 1 n - \frac {1}{N} \right) {S^2_y} \,\, (\#eq:eqpro13) 
$$

$$
V_{AAS} (\overline y) = \left( \frac 1 n - \frac {1}{N} \right) {S^2_y} \,\, (\#eq:eqpro14) 
$$

Então, no caso de variáveis $y$ do tipo indicadoras, tem-se que as variâncias do estimador do total e da proporção populacionais são dadas por:

$$
V_{AAS} (\widehat {N} _A) = N^2 \left( \frac 1 n - \frac {1}{N} \right) \frac{N}{N-1} p(1-p) \,\, (\#eq:eqpro15) 
$$

$$
V_{AAS} (\widehat p) = \left( \frac 1 n - \frac {1}{N} \right) \frac{N}{N-1} p(1-p) \,\, (\#eq:eqpro16) 
$$

Note que para populações onde o número de unidades $N$ é suficientemente grande, tem-se que $V_{AAS} (\widehat p) \approx \frac {p (1 - p)}{n}$, resultando numa equivalência aproximada entre os desempenhos da *AAS* e da *AASC* na estimação da proporção populacional. Intuitivamente, isso ocorre porque a probabilidade de seleção repetida sob *AASC* tende a ser muito pequena no caso de populações muito grandes.

Utilizando $s^2_y$ como estimador não viciado para $S^2_y$ chega-se aos estimadores para as variâncias dos estimadores de total e proporção:

$$
\widehat V_{AAS} (\widehat {N} _A) = N^2 \left( \frac 1 n - \frac {1}{N} \right) \frac {\widehat p (1 - \widehat p)} {n-1} \,\,(\#eq:eqpro17) 
$$

$$
\widehat V_{AAS} (\widehat p) = \left( \frac 1 n - \frac {1}{N} \right) \frac {\widehat p (1 - \widehat p)} {n-1} \,\,(\#eq:eqpro18) 
$$

O quadro 5.2 reúne os resultados principais da estimação de contagens e proporções sob *AAS*.

\begin{eqnarray} {|c|c|} \hline
\textrm{Parâmetro} & \textrm{Estimador ENV sob AAS} 
\\ \hline N_A = \displaystyle \sum_{i \in U} y_i & \widehat N_A = N \times n_A / n = N \times p
\\ \hline p = N_A / n & \widehat{p} = n_a / n 
\\ \hline \S^2_y = \frac{N}{N-1} p (1-p) & s^2_y = \displaystyle \frac{n}{n-1} \widehat p (1 - \widehat p)  
\\ \hline V_{AASC}(\widehat N_A) = N^2 \left( \frac 1 n - \frac {1}{N} \right) \frac{N}{N-1} p(1-p) & N^2 \left( \frac 1 n - \frac {1}{N} \right) \frac {\widehat p (1 - \widehat p)} {n-1}
\\ \hline V_{AAS} (\widehat p) = \left( \frac 1 n - \frac {1}{N} \right) \frac{N}{N-1} p(1-p) & \widehat V_{AAS} (\widehat p) = \left( \frac 1 n - \frac {1}{N} \right) \frac {\widehat p (1 - \widehat p)} {n-1}
\\ \hline
\end{eqnarray}


## Distribuição amostral exata de estimadores de proporção sob AASC e AAS

Na *AASC* as unidades amostrais são selecionadas com igual probabilidade e com reposição a cada sorteio. Então as variáveis aleatórias $Y_k$ que correspondem aos valores observados na amostra a cada sorteio $k$,  $k=1, \dots, n$, são independentes e identicamente distribuídas com probabilidades definidas por:

$$
\displaystyle P(Y_k = 1) = P(y_{i_k} \text{ ter o atributo de interesse}) = \frac {N_A} {N} = p \\ P(Y_k = 0) = P(y_{i_k} \text{ não ter o atributo de interesse}) = 1 - \frac {N_A} {N} = 1-p \,\, (\#eq:eqpro19) 
$$

Dessa maneira fica configurada uma distribuição de $Bernoulli(p)$ para cada uma dessas variáveis:

\begin{array}{c | c c} 
 {v} & \ 1 & 0 \\
\hline \text{$P(Y_k = v)$} & p & 1-p  \\
\end{array}

Ainda sob *AASC*, a soma amostral $t_y = n_A$ que representa o número de unidades na amostra com o atributo de interesse, é então dada pelo soma de $n$ variáveis aleatórias IID com distribuição $Bernoulli(p)$. Portanto, sob *AASC* a variável aleatória $t_y = n_A$ segue uma distribuição $Binomial(n, p)$. Imediatamente tem-se que:

$$
E_{AASC}(n_A) = n p {\quad \text e \quad} V_{AASC}(n_A) = n p (1-p) \,\, (\#eq:eqpro20) 
$$

Seguindo o mesmo raciocínio, pode-se ter o valor esperado e a variância de $\widehat p$:

$$
\displaystyle E_{AASC} (\widehat p) = E_{AASC} \left(\frac{n_A}{n}\right) = p  {\quad\text e \quad} V_{AASC}(\widehat p) = V_{AASC} \left( \frac{n_A}{n} \right) = \frac {p (1-p)} {n} \,\, (\#eq:eqpro21) 
$$

Outro resultado importante é que nesse caso se pode obter a distribuição de probabilidades exata de $\widehat p$, pois:

$$
P \left(\widehat p = \frac v n \right) = P(n_a = v) = \binom{n} {v} p^v (1-p)^{n-v} ,{\quad\quad\quad\quad \text{para todo }}v=0, 1, 2, ..., n \,\, (\#eq:eqpro22) 
$$

Esta distribuição corresponde apenas a uma transformação escalar da distribuição $Binomial(n, p)$, onde a contagem de sucessos ($n_A$) é dividida pelo número de sorteios ($n$).

Sob *AAS*, a distribuição da contagem de sucessos ($n_A$) tem uma distribuição de probabilidades 
$Hipergeométrica(N, N_A, N)$. Isto ocorre porque sob *AAS* os $n$ sorteios são feitos da população sem reposição, e portanto, a cada nova unidade sorteada, o número de unidades remanescentes na população com o atributo de interesse varia, dependendo do número dessas unidades já selecionadas.

O número total de amostras aleatórias simples sem reposição de tamanho $n$ que podem ser selecionadas de uma população com $N$ unidades é dado por $\binom{N}{n}$, e o número dessas amostras com exatamente $v$ unidades com a característica em estudo e $n-v$ unidades sem essa característica pode se calculado por $\binom{N_A}{v}\binom{N-N_A}{n-v}$. Sendo assim, a distribuição de probabilidades da variável aleatória $t_y = n_A$ é então dada por:

$$
P \left(n_A = v \right) = \frac {\binom{N_A} {v} \binom{N-N_A} {n-v}}{\binom{N} {n}} , {\quad\quad \text{para todo }} v=0, 1, 2, ..., min(n;N_A) \,\, (\#eq:eqpro22) 
$$

e assim fica também determinada a distribuição exada de probabilidades do estimador $\widehat p$, que é a mesma, mas com os valores possíveis da proporção amostral divididos pelo tamanho da amostra $n$.


## Intervalos de confiança para proporções na Amostragem Aleatória Simples

Foi visto que na *Amostragem Aleatória Simples*, tanto com ou sem reposição, são conhecidas as distribuições exatas para o estimador $\widehat p$. Portanto, é possível obter os limites inferior e superior para intervalos de confiança para a proporção $p$, com um nível de significância $\alpha$ fixado. Para isso, no caso de *AASC*, é necessário resolver o sistema de equações determinando os valores de $\widehat p_I$ e $\widehat p_S$ que satisfaçam:

$$
\begin{cases} 
\displaystyle \sum _{v=0}^{n_A} \binom {n}{v} \widehat p_S^v (1 - \widehat p_S)^{n-v} = \alpha / 2 
\\\\ 
\displaystyle \sum _{v=n_A}^n \binom {n}{v} \widehat p_I^v (1 - \widehat p_I)^{v-k} = \alpha / 2 \end{cases} \,\, (\#eq:eqpro23) 
$$

No caso da *AAS* o sistema a ser resolvido é baseado na distribuição Hipergeométrica como se segue:

$$
\begin{cases} 
\displaystyle \sum_ {v=0}^{n_A}\frac {\binom{N\widehat p_S}{v} \binom{N-N\widehat p_S} {n-v}}{\binom{N}{n}} = \alpha / 2
\\\\ 
\displaystyle \sum_ {v=n_A}^{n}\frac {\binom{N\widehat p_I}{v} \binom{N - N \widehat p_I} {n-v}} {\binom{N}{n}} = \alpha / 2
\end{cases} \,\, (\#eq:eqpro24) 
$$

Em ambos os casos $1 - \alpha$ é o *nível de confiança* desejado. Por exemplo, para intervalos de 95% de confiança, deve-se usar $\alpha=0,05$.

XXX SUBSTITUIR O PARÁGRAFO ABAIXO POR EXEMPLO DE CÓDIGO R PARA RESOLVER XXX

A solução desses sistemas pode ser trabalhosa, exigindo aplicação de métodos iterativos que exigem quantidade razoavelmente grande de recursos computacionais. [@Cochran1977] dá alguns exemplos e referências para a solução desses problemas. 

XXX

Na maioria dos casos práticos, essa dificuldade leva à opção pelo uso da aproximação pela distribuição Normal de probabilidades. Isso pode ser feito sempre que as condições do problema assim o permitirem, como se discute na próxima seção.

## Intervalos de confiança utilizando a Aproximação Normal

Como já foi visto no capítulo anterior, a distribuição do estimador da proporção, $\widehat p$, pode ser aproximada pela distribuição Normal de probabilidade. Esta aproximação pode ser utilizada mesmo no caso da *AAS* onde os $y_i$ observados na amostra não são independentes, desde que se tenha valores de $N$ e $n$ suficientemente grandes e valor da fração amostral, $f=\frac n N$, pequeno.

Sob estas condições pode-se considerar que:

\begin{equation}
\frac {\widehat p - p} {\sqrt {V_{p(s)}(\widehat p)}} \simeq N(0,1)(\#eq:eqpro28) 
\end{equation}

Na Figura \@ref(fig:normalaasc) a seguir o gráfico mostra a aproximação Normal para a seleção de 1000 amostras de tamanho $n=100$, selecionadas com reposição, de uma população de tamanho $N=5000$, onde exatamente metade das unidades tem a caracterísitica de interesse ($y_i=1$).
<center>
```{r,normalaasc,echo=F,fig.cap="Aproximação Normal no caso de uma *AASC*"}
x=0
s=0

for (i in 1:5000){ifelse (i/2-as.integer(i/2)>0, x[i]<-1,x[i]<-0)}

for(j in 1:1000){s[j]=mean(sample(x,100,replace=T))}

s=(s-.5)/sqrt(.25/100)
hist(s, freq = F, main="Aproximação Normal - AASC", xlab="X", ylab="Densidade")
curve(dnorm(x), col=2, lty=2, lwd=2, add=T)
```

</center>

A Figura \@ref(fig:normalaas) mostra o gráfico para um exercício similar ao anterior onde as amostras foram selecionadas sem reposição.

<center>
```{r,normalaas,echo=F,fig.cap="Aproximação Normal no caso de uma *AAS*"}
x=0
s=0

for (i in 1:5000){ifelse (i/2-as.integer(i/2)>0, x[i]<-1,x[i]<-0)}

for(j in 1:1000){s[j]=mean(sample(x,100,replace=F))}

s=(s-.5)/sqrt(.25/100)
hist(s, freq = F, main="Aproximação Normal - AAS", xlab="X", ylab="Densidade")
curve(dnorm(x), col=2, lty=2, lwd=2, add=T)
```

</center>

Tanto nos casos de seleção com ou sem reposição pode-se considerar que as aproximações são satisfatórias, com os histogramas das distribuições amostrais do estimador $\widehat p$ aderindo consideravelmente à curva Normal padrão.

[@Cochran1977] mostra uma tabela, reproduzida na Tabela 5.1, com oalguns valores mínimos do total de unidades observadas na amostra, $t_y$, onde a aproximação Normal pode se utilizada.

<center> Tabela 5.1 - Valores mínimos de $t_y$ para uso da aproximação Normal

\begin{array}{r r r} 
\hline
 P &  t_y & n \\
\hline   
0,5 & 15 & 30 \\
0,4 & 20 & 50 \\
0,3 & 24 & 80 \\
0,2 & 40 & 200 \\
0,1 & 60 & 600 \\
0,05 & 70 & 1400 \\
\approx 0 & 80 & \infty \\
\hline
\end{array}
</center>

Essa tabela foi construída considerando um nível de significância de $\alpha=0,05$, que é um valor comumente utilizado em muitas situações práticas.Tem-se a partir daí critérios práticos para assumir a utilização da aproximação Normal, notando-se que o tamanho mínimo da amostra requerido é de $n=30$.

Nas condições estabelecidas para a validade da aproximação Normal tem-se que $S^2_y \approx \sigma^2_y=pq$, portanto, $\displaystyle V_{AAS}(\widehat p) \approx V_{AASC}(\widehat p)$, então para os dois tipos de seleção pode-se considerar o intervalo de confiança para a proporção como: 
\begin{equation} 
\displaystyle IC_{1-\alpha}(p):\left[\widehat p-z_{\alpha/ 2}\sqrt { {pq}/n};\widehat p+z_{\alpha/2}\sqrt {{pq}/n} \right](\#eq:eqpro29) 
\end{equation}

Caso se deseje considerar o fator de correção para populacões finitas, quando a fração amostral não possa ser considerada pequena e a seleção for sem reposição, a expressão do intervalo de confiança passa a ser: 
\begin{equation} 
\displaystyle IC_{1-\alpha}(p):\left[\widehat p-z_{\alpha/ 2}\sqrt { \left(\frac{N-n}{N-1} \right)\frac{pq}{n}};\widehat p+z_{\alpha/2}\sqrt { \left(\frac{N-n}{N-1} \right)\frac{pq}{n}} \right](\#eq:eqpro30) 
\end{equation}

Em [@Cochran1977] é apresentada uma *correção de continuidade* acrescentando a fração $1/2n$ à margem de erro do intervalo de confiança pelo fato de se fazer uma aproximação de uma distribuição discreta (Binomial ou Hipergeométrica) pela distribuição Normal, que é contínua. Desse modo a expressão do intervalo de confiança passa a ser: 
\begin{equation} 
\displaystyle IC_{1-\alpha}(p):\left[\widehat p-z_{\alpha/ 2}\sqrt {{pq}/n}-1/2n;\widehat p+z_{\alpha/2}\sqrt{{pq}/n} +1/2n \right](\#eq:eqpro31) \end{equation}
Ou considerando a coreção para população finita:
\begin{equation} 
\displaystyle IC_{1-\alpha}(p):\left[\widehat p-z_{\alpha/ 2}\sqrt { \left(\frac {N-n}{N-1} \right)\frac{pq}{n}}-\frac 1 {2n};\widehat p+z_{\alpha/2}\sqrt { \left(\frac {N-n}{N-1} \right)\frac{pq}{n}}+\frac 1{2n} \right](\#eq:eqpro32) 
\end{equation}


Nas aplicações práticas o valor da variância do estimador da proporção $p$, geralmente, não é conhecido. Assim o que se pode fazer é estimar um intervalo de confiança, substituindo $S^2_y$ por $s^2_y$ na expressões anteriores:
\begin{equation} 
\displaystyle ic_{1-\alpha}(p):\left[\widehat p-z_{\alpha/ 2}\sqrt {\frac{\widehat p \widehat q} {n-1}}-\frac 1{2n};\widehat p+z_{\alpha/2}\sqrt{\frac{\widehat p \widehat q} {n-1}} +\frac 1{2n} \right](\#eq:eqpro33)
\end{equation} 

\begin{equation} 
\displaystyle ic_{1-\alpha}(p):\left[\widehat p-z_{\alpha/ 2}\sqrt {\left(\frac{N-n}{N}\right)\frac {\widehat p\widehat q}{n-1}}-\frac 1{2n};\widehat p+z_{\alpha/2}\sqrt {\left(\frac{N-n}{N}\right)\frac {\widehat p\widehat q}{n-1}} +\frac 1{2n} \right](\#eq:eqpro34) 
\end{equation}

Veja que o efeito da correção de continuidade tende rapidamente a ser nulo quando o tamanho da amostra, $n$, cresce. Para uma amostra de tamanho $n=50$ esse fator já é de apenas 1%, o que pode ser desprezível dependendo da proporção que estiver sendo estimada, porém é preciso muito cuidado pois quando se está trabalhando com proporções são valores, às vezes, bastante pequenos.

## Cálculo do tamanho da amostra

O tamanho de uma amostra aleatória simples a ser selecionada, como já foi visto no capítulo anterior, será calculado a partir da definição do erro amostral ou margem de erro admissível para o caso, do nível de confiança desejado e se a seleção for com ou sem reposição.

No caso de seleção com reposição, considerando uma margem de erro máxima admissível de $d$ com um nível de confiança $1-\alpha$, basta utilizar expressão da margem de erro:
\begin{equation}
d \le z_{\alpha/2}\sqrt { \frac{pq}{n}} \implies n \ge \frac{z^2_{\alpha/2}pq}{d^2} (\#eq:eqpro35) 
\end{equation}
Para seleção sem reposição o tamanho da amostra será calculado como:
\begin{equation}
d \le z_{\alpha/2}\sqrt{\left(\frac {N-n}{N-1}\right)\frac{pq}n} \implies n \ge \frac{z^2_{\alpha/2}pq} {d^2 \frac {N-1}N + \frac 1 N {z^2_{\alpha /2}pq}}\approx \frac{z^2_{\alpha/2}pq} {d^2 + \frac 1 N {z^2_{\alpha /2}pq}} (\#eq:eqpro36) 
\end{equation}
Uma maneira prática de calcular o tamanho da amostra para uma *AAS* em dois passos é calcular primeiro: 
\begin{equation}
n_0=\frac{z^2_{\alpha/2}pq}{d^2}(\#eq:eqpro37) 
\end{equation}
E depois fazer:
\begin{equation}
n \ge \frac {n_0}{1+n_0 /N}(\#eq:eqpro38) 
\end{equation}

Note que $n_0$ é equivalente ao tamanho da amostra para uma *AASC* e o valor de $n$ para a *AAS* é obtido pela correção para população finita do valor $n_0$. Também pode-se concluir que quando o tamanho da população, $N$, é grande o fator $n_0/N$ tende a se anular fazendo com que $n=n_0$, ou seja: quando o tamanho da população é grande as amostras aleatórias simples com ou sem reposição são equivalentes.

AS fórmulas apresentadas dependem do nivel de significância $\alpha$ e da margem de erro $d$ que serão definidos pelo pesquisador de acordo com seu conhecimento relativo ao assunto pesquisado, pois esses valores estão diretamente  ligados à natureza da pesquisa. Pesquisas que utilizam medidas objetivas para alcançar seus resultados, como instrumentos para se medir fisicamente o fenômeno estudado, podem ser mais exigentes quanto a presisão das estimativas desejadas, enquanto que pesquisas da área social, por exemplo, onde se utilizam questionários que dependem da memória ou até da boa vontade dos entrvistados, frequentemente não podem ter o mesmo nível de exigência. O tamanho da amostra também depende da variância da variável utilizada para seo cálculo, através do produto $pq$. Como $p$ é a proporção que se deseja estimar, se fosse conhacida não haveria a necessidade de uma amostra. Geralmente, como no caso de se pesquisar variáveis continuas, utiliza-se pesquisas anteriores ou sobre variáveis correlacionadas com a atual variável de interesse, ou mesmo uma pesquisa piloto com um tamanho arbitrário de amostra para se ter uma estimativa inicial do fenomeno a ser medido e poder calcular o tamanho de amostra realmente necessário. Quando se utiliza uma pesquisa piloto existem métodos para utilizar os resultados relativos às unidades já pesquisadas e selecionar outras unidades para complementar o tamanho da amostra.

No caso da estimação de proporções o valor de $pq$ é limitado variando de 0 a 0,25, sendo esse valor máximo atingido quando $p=q=0,5$. O gráfigo da Figura \@ref(fig:varp) mostra como variam os valores de $pq$ conforme variam os valore de $p$.

<center>
```{r, varp,fig.cap="Variação de $pq$ em função dos valores de $p$",echo=F}
p=seq(0,1, by=0.001)
pq=p*(1-p)
plot(p,pq, type="l", main="Gráfico de pq x p",xlab="Proporção = p",ylab="Variância = pq")
```
</center>

Como o valor máximo da variância é atingido quando $p=0,5$, caso não exista nenhuma informação sobre a proporção a ser estimada, uma maneira de determinar um tamanho de amostra conservador é supor exatamente que $p=0,5$. Assim pode-se simplificar a fórmula de cálculo de $n$ para uma *AASC*: 
\begin{equation} 
n \ge \frac {z^2_{\alpha /2}}{4d^2}(\#eq:eqpro39) 
\end{equation}
No caso de uma *AAS* basta fazer:
\begin{equation}
n_0 = \frac {z^2_{\alpha /2}}{4d^2} \implies n \ge \frac {n_0}{1+n_0/N}(\#eq:eqpro40) 
\end{equation}

Geralmente os resultados das fórmulas para cálculo do tamanho da amostra não são valores inteiros. Em todos esses casos o valor de $n$ calculado deverá ser arredondado para o valor inteiro imediatamente superior, preservando assim a precisão desejada.

### Cálculo do $n$ utilizando outras formas de representar o erro amostral

As fómulas apresentadas para o cálculo do tamanho da amostra utilizaram a margem de erro $d$ como parâmetro de entrada, porém o erro amostral pode ser representado de outras maneiras. Pode-se defini-lo como o *coeficiente de cariação*, como a *variância* ou como o *erro relativo* do estimador a ser calculado.

Para calcular um tamanho de amostra de maneira que o coeficiente de variação máximo esperado para o estimador $\widehat p$ seja um valor fixado $c$, pode-se utilizar a fórmula:
\begin{equation}
n \ge \frac q {c^2p}(\#eq:eqpro41) 
\end{equation}
no caso da seleção com reposição.

Para chegar a esse resultado basta ver que $CV_{AASC}(\widehat p)= \sqrt {V_{AASC}(\widehat p)}/p$ e substituir na fórmula apresentada para o cálculo de $n$ a partir da margem de erro fixada.

Para a seleção sem reposição pode-se fazer:
\begin{equation}
n_0 = \frac q {c^2p} \implies n \ge \frac {n_0} {1+n_0/N}(\#eq:eqpro42) 
\end{equation}

Seguindo o mesmo raciocínio pode-se chegar às formulas para calcular *n* fixando a variância máxima esperada de $\widehat p$ em $v$ ou o seu erro relativo máximo em $r$.

Para a seleção com reposição tem-se:
\begin{equation}
n \ge \frac {pq} {v}  { \quad\textrm { ou } \quad} n \ge \frac {z^2_{\alpha/2}}{r^2} \frac q p (\#eq:eqpro43) 
\end{equation}

As expressões para a seleção sem reposição são derivadas como no caso em que foi fixado o valor máximo esperado para $CV(\widehat p$).


## Estimação de proporções para variáveis com mais duas categorias

Até o momento foi tratado o caso em que temos uma variável indicadora com duas categorias, definindo se uma determinada unidade na população (ou na amostral) tem ou não determinada característica de interesse. Muitas vezes temos a necessidade de definir mais de duas categorias como, por exemplo:

* estudar a distribuição por faixas etárias de uma localidade ou grupo de pessoas;
* estudar a classificação econômica das empresas de determinado país;
* estimar a intenção de votos dos candidatos em uma eleição com mais de 2 candidatos, além das possibilidades de voto em branco ou nulo ou, ainda, ou eleitores indecisos.

Nestes casos há interesse de estimar a proporção de unidades em cada uma das possíveis categorias e respectiva precisão dessas estimativas.

**Exemplo :** Seja uma escola com 1000 alunos distribuídos entre as 9 etapas do ensino fundamental como na tabela seguinte:
\small
\begin{array}{l|r r r r r r r r r} 
\hline
\text{Etapa de ensino}	& \text{1° ano} & \text{2° ano} &	\text{3° ano} &\text{4° ano} &\text{5° ano} &\text{6° ano}	& \text{7° ano} & \text{8° ano}	& \text{9° ano} & \text{Total}\\
\hline
\text {Alunos}	& 110 &	108 &	110	& 115	& 104	& 119	& 116	& 107	& 111 &	1000\\
\hline
\text {Proporção}	& 0,110	& 0,108& 0,110	& 0,115	& 0,104	& 0,119	& 0,116	& 0,107	& 0,111	& 1,000\\
\hline
\end{array}
\normalsize

Observe que para calcular as proporções em cada uma das categorias na verdade o que se faz é atribuir o valor 1 às unidades da categoria em questão e o valor 0 para as unidades pertencente às demais categorias. Em outras palavras, se a variável tem $M$ categorias é como se fossem $M$ problemas com duas categorias.

A proporção de unidades da população pertencentes à categoria $c\in (1, 2,.., M)$, é dada por:

\begin{equation}
p_c=\frac {N_c} {N}  (\#eq:eqpro44) 
\end{equation}
0nde $N_c$ é o número de unidades na categoria $c$ e $N$ é o tamanho total da população.

Seja uma amostra aleatória simples (com ou sem reposição) de tamanho $n$ e seja a variável indicadora $y_i$ definida como:
\begin{equation}
\displaystyle y_i= \begin{cases} 1, \text {se a unidade i pertence à categoria $c$} \\\\ 0, \text {se a unidade i não pertence à categoria $c$} \end{cases}(\#eq:eqpro45)
\end{equation}

Com tal definição pode-se ver que o número de unidades da catecoria $c$ na amostra será dado por::
\begin{equation}
\displaystyle n_c=\sum_{i=1}^{n} y_i(\#eq:eqpro46)
\end{equation}
Um estimador para a proporção de unidades populacionais pertencentes à categoria $c$  poderá ser obtido por:
\begin{equation}
\displaystyle \widehat p_c=\frac {1}{n} \sum_{i=1}^{n} y_i =\frac {n_c} {n}(\#eq:eqpro47)
\end{equation}
O problema foi reduzido ao caso de estimar proporções em variáveis com duas categorias.
Pode-se obter, também, estimativas de precisão utilizando as mesmas ferramentas já apresentadas neste capítulo.

Muitas vezes pode-se estar interessado em estimar proporções para agrupamentos das categorias originais. 

Voltando ao exemplo da escola do ensino fundamental, pode ser de interesse estudar a proporção de seus alunos que estão matriculados no primeiro segmento do ensino fundamental. Nesse caso seriam contabilizados como pertencentes à categoria $c$ de interesse todos os alunos do 1º até o 5º ano, para os quais $y_c=1$, sendo $y_c=0$ para os demais alunos da escola.

Outro caso de interesse ocorre quando na aplicação de um questionário, por exemplo, aparecem respondentes que se recusaram a responder ou,mesmo, disseram que não sabiam a resposta. Num caso como esse pode-se estar interessado em estimar a proporção das pessoas que responderam determinada alternativa, entre as pessoas que efetivamente responderam a pesquisa escolhendo uma das alternativas válidas. Um exemplo prático seria uma pesquisa sobre a intenção de voto numa eleição com apenas dois candidatos. Neste caso o entrevistado poderia reponder que votará no canditato A, no candidato B, que votará nulo ou em branco, onde apenas as duas primeiras alternativas seriam considerados como votos válidos.

Neste caso poderia ser estimada a proporção para cada uma das quatro categorias iniciais ou apenas a proporção de votos válidos para cada um dos dois candidatos.
\begin{equation}
\displaystyle \widehat p_A=\frac {n_A} {n_A+n_B} \quad\text { e } \quad\widehat p_B=\frac {n_B} {n_A+n_B}(\#eq:eqpro48)
\end{equation}

Vale notar que neste caso tanto o numerador como o denominador do estimador da proporçãO são variáveis aleatórias, pois a população (eleitores que efetivamente vão votar num dos candidatos) é desconhecida.

XXX INSERIR AQUI XXX

Obtenção de intervalos de confiança quando a AASC tem tamanho pequeno ou modesto - exemplificar.

Discussão de quando a aproximação Normal da proporção amostral é útil. Intervalos de confiança sob a aproximação Normal - exemplificar.
